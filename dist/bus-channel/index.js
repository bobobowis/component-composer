"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var BusChannel=function(){function a(b){var c=b.id,d=b.actionFactory;_classCallCheck(this,a),this.actionFactory=d,this.id=this.actionSubscribers={}}return _createClass(a,[{key:"subscribe",value:function subscribe(a){var b=this,c=a.actionId,d=a.subscriber;return this.hasSubscribers(c)||(this.actionSubscribers[c]=[]),this.actionSubscribers[c].push(d),function(){return b.unsubscribe({actionId:c,subscriber:d})}}},{key:"subscribeAll",value:function subscribeAll(a){return this.subscribe("*",a)}},{key:"unsubscribe",value:function unsubscribe(a){var b=a.actionId,c=a.subscriber,d=this.getSubscriberIndex({actionId:b,subscriber:c});-1<d&&this.actionSubscribers[b].splice(d,1)}},{key:"hasSubscribers",value:function hasSubscribers(a){return Array.isArray(this.actionSubscribers[a])}},{key:"getSubscriberIndex",value:function getSubscriberIndex(a){var b=a.actionId,c=a.subscriber,d=this.hasSubscribers(b);return d?this.actionSubscribers[b].indexOf(c):-1}},{key:"unsubscribeAll",value:function unsubscribeAll(a){this.actionSubscribers[a]=[]}},{key:"reset",value:function reset(){this.actionSubscribers={}}},{key:"getSubscribers",value:function getSubscribers(a){var b=this.actionSubscribers[a];return b}},{key:"createAction",value:function createAction(a){var b=a.id,c=a.payload,d=this.actionFactory.create({id:b,source:this.id,payload:c});return d}},{key:"publish",value:function publish(a){var b=a.id,c=a.type,d=a.payload,e=this.createAction({id:b,emitter:this.id,type:c,payload:d});this.executeSubscribers("*",e),this.executeSubscribers(e.id,e)}},{key:"executeSubscribers",value:function executeSubscribers(a,b){var c=this.getSubscribers(a);c&&c.forEach(this.executeSubscriber.bind(this,b))}},{key:"executeSubscriber",value:function executeSubscriber(a,b){b.call(this,a)}},{key:"subscribeOnce",value:function subscribeOnce(a){var b=this,c=a.actionId,d=a.subscriber,e=this.subscribe({actionId:c,subscriber:function subscriber(){e();for(var a=arguments.length,c=Array(a),f=0;f<a;f++)c[f]=arguments[f];d.apply(b,c)}})}}]),a}();module.exports=BusChannel;