"use strict";function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var DTOMapper=function(){function a(b){var c=b.dtos,d=b.mappingInfo;_classCallCheck(this,a),this.dtos=c,this.mappingInfo=d}return _createClass(a,[{key:"reset",value:function reset(){this.dtos.reset(),this.mappingInfo.reset()}},{key:"update",value:function update(a){this.reset(),this.mapStateToDTOs(a)}},{key:"getMappingInfo",value:function getMappingInfo(a){return this.mappingInfo.get(a)}},{key:"getDTO",value:function getDTO(a){return this.dtos.get(a)}},{key:"addMappingInfo",value:function addMappingInfo(a,b){this.mappingInfo.add(a,b)}},{key:"addDTO",value:function addDTO(a,b){this.dtos.add(a,b)}},{key:"isChunk",value:function isChunk(a){return a.hasOwnProperty("dto")&&a.hasOwnProperty("id")&&a.hasOwnProperty("schema")&&a.hasOwnProperty("template")}},{key:"mapStateToDTOs",value:function mapStateToDTOs(a){for(var b in a)a[b]&&this.isChunk(a[b])&&this.mapDTO(a[b],b)}},{key:"getPath",value:function getPath(a,b){return b?"".concat(b,".").concat(a,".dto"):"".concat(a,".dto")}},{key:"getPathArray",value:function getPathArray(a,b,c){return"".concat(a,".").concat(b,"[").concat(c,"].dto")}},{key:"mapDTOsArrayElement",value:function mapDTOsArrayElement(a,b,c,d){var e=this,f={};for(var g in a.dto)a.dto[g]&&this.isChunk(a.dto[g])?(this.mapDTO(a.dto[g],g,this.getPathArray(c,d,b)),f[g]={id:a.dto[g].id,dto:this.getDTO(a.dto[g].id),schema:a.dto[g].schema,template:a.dto[g].template}):Array.isArray(a.dto[g])&&this.isArrayOfChunks(a.dto[g])?(this.findDTOsInArray(a.dto[g],g,this.getPathArray(c,d,b)),f[g]=a.dto[g].map(function(a){return{id:a.id,dto:e.getDTO(a.id),schema:a.schema,template:a.template}})):f[g]=a.dto[g];this.addDTO(a.id,f),this.addMappingInfo(a.id,this.getPathArray(c,d,b))}},{key:"findDTOsInArray",value:function findDTOsInArray(a,b,c){var d=this;a.forEach(function(a,e){d.mapDTOsArrayElement(a,e,c,b)})}},{key:"isArrayOfChunks",value:function isArrayOfChunks(a){var b=a[0];return!!(b&&"object"===_typeof(b)&&this.isChunk(b))}},{key:"mapDTO",value:function mapDTO(a,b,c){for(var d,e=this,f=a.id,g=Object.keys(a.dto),h={},i=0,j=g;i<j.length;i++)d=j[i],a.dto[d]&&this.isChunk(a.dto[d])?(this.mapDTO(a.dto[d],d,this.getPath(b,c)),h[d]={id:a.dto[d].id,dto:this.getDTO(a.dto[d].id),schema:a.dto[d].schema,template:a.dto[d].template}):Array.isArray(a.dto[d])&&this.isArrayOfChunks(a.dto[d])?(this.findDTOsInArray(a.dto[d],d,this.getPath(b,c)),h[d]=a.dto[d].map(function(a){return{id:a.id,dto:e.getDTO(a.id),schema:a.schema,template:a.template}})):h[d]=a.dto[d];this.addDTO(f,h),this.addMappingInfo(f,this.getPath(b,c))}}]),a}();module.exports=DTOMapper;