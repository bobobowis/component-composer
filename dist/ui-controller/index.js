"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var UIController=function(){function a(b){var c=b.id,d=b.schema,e=b.dtoMapper,f=b.controllers,g=b.template,h=b.bus;_classCallCheck(this,a),this.id=c,this.schema=d,this.template=g,this.dtoMapper=e,this.controllers=f,this.bus=h,this.selector="#".concat(c),this.bus.addChannel(this.id),this.bindings(),this.subscribers()}return _createClass(a,[{key:"subscribers",value:function subscribers(){this.bus.getChannel(this.id).subscribe({actionId:"DTO_CHANGED",subscriber:this.onDTOChanged.bind(this)})}},{key:"subscribe",value:function subscribe(a,b){this.bus.getChannel(this.id).subscribe({actionId:a,subscriber:b})}},{key:"subscribeTo",value:function subscribeTo(a,b,c){this.bus.subscribe(a,b,c)}},{key:"onDTOChanged",value:function onDTOChanged(a){var b=a.payload;this.apply(b)}},{key:"getDTO",value:function getDTO(){return this.dtoMapper.getDTO(this.id)}},{key:"apply",value:function apply(){this.render()}},{key:"render",value:function render(){var a=this.getDTO(),b=this.template(a);document.querySelector("".concat(this.selector)).innerHTML=b,this.bindings(),this.childrenBindings()}},{key:"childrenBindings",value:function childrenBindings(){var a=this.getComponentNodes("[data-component]");a.forEach(this.childBindings.bind(this))}},{key:"childBindings",value:function childBindings(a){var b=a.id,c=this.controllers.get(b);c&&c.bindings()}},{key:"getComponentNode",value:function getComponentNode(a){return document.querySelector("".concat(this.selector," ").concat(a))}},{key:"getComponentNodes",value:function getComponentNodes(a){return document.querySelectorAll("".concat(this.selector," ").concat(a))}},{key:"bindTo",value:function bindTo(a,b,c){var d=this.getComponentNodes(a);d.forEach(function(a){a.addEventListener(b,c)})}},{key:"publishTo",value:function publishTo(a,b,c){this.bus.getChannel(a).publish({id:b,emitter:this.id,type:this.schema,payload:c})}},{key:"dispatch",value:function dispatch(a,b){this.bus.getChannel("DISPATCHER").publish({id:a,emitter:this.id,type:this.schema,payload:b})}},{key:"publish",value:function publish(a,b){this.bus.getChannel(this.id).publish({id:a,emitter:this.id,type:this.schema,payload:b})}},{key:"bindings",value:function bindings(){}}]),a}();module.exports=UIController;